<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display - Ice Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .nav-button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background 0.3s;
        }
        .nav-button:hover {
            background: #0056b3;
        }
        .nav-button.admin { background: #28a745; }
        .nav-button.admin:hover { background: #1e7e34; }
        .nav-button.visor { background: #dc3545; }
        .nav-button.visor:hover { background: #c82333; }
        .nav-button.home { background: #6c757d; }
        .nav-button.home:hover { background: #545b62; }
        
        .grid-demo {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .grid-item {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            padding: 20px;
            text-align: center;
            border-radius: 5px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .controls {
            background: #e9ecef;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .controls label {
            margin-right: 20px;
        }
        .controls input {
            margin: 0 5px;
            padding: 5px;
        }
        .controls button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .available-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .available-item {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            padding: 15px;
            border-radius: 8px;
            cursor: move;
            transition: all 0.3s;
            min-width: 120px;
            text-align: center;
        }
        
        .available-item:hover {
            background: #e9ecef;
            border-color: #007bff;
        }
        
        .available-item img {
            max-width: 60px;
            max-height: 60px;
            border-radius: 50%;
            margin-bottom: 8px;
        }
        
        .grid-item {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            padding: 20px;
            text-align: center;
            border-radius: 5px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .grid-item:hover {
            background: #e9ecef;
            border-color: #007bff;
        }
        
        .grid-item.dragover {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .grid-item img {
            max-width: 60px;
            max-height: 60px;
            border-radius: 50%;
            margin-bottom: 8px;
        }
        
        .grid-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-buttons">
            <a href="/ice-panel/" class="nav-button home">üè† Home</a>
            <a href="/ice-panel/display" class="nav-button">üì± Display</a>
            <a href="/ice-panel/admin" class="nav-button admin">‚öôÔ∏è Admin</a>
            <a href="/ice-panel/visor" class="nav-button visor">üëÅÔ∏è Visor</a>
        </div>
        
        <h1>üì± Display - Painel de Controle</h1>
        <p>Configure o layout do painel de sorvetes.</p>
        
        <div class="controls">
            <label>Colunas: <input type="number" id="gridColumns" value="3" min="1" max="8" onchange="updateGrid()" /></label>
            <label>Linhas: <input type="number" id="gridRows" value="3" min="1" max="8" onchange="updateGrid()" /></label>
            <button onclick="clearGrid()">Limpar Grid</button>
        </div>
        
        <div id="displayGrid" class="grid-demo">
            <!-- Grid ser√° gerado dinamicamente -->
        </div>
        
        <div style="margin-top: 30px;">
            <h3>üì¶ Itens Dispon√≠veis</h3>
            <div id="availableItems" class="available-items">
                <!-- Itens ser√£o carregados do localStorage -->
            </div>
        </div>
        
        <div style="margin-top: 30px; padding: 20px; background: #d4edda; border-radius: 5px; border-left: 4px solid #28a745;">
            <h3>‚úÖ Funcionalidades do Display:</h3>
            <ul>
                <li>‚úÖ Configurar n√∫mero de colunas e linhas</li>
                <li>‚úÖ Arrastar e soltar sorvetes</li>
                <li>‚úÖ Gerenciar categorias</li>
                <li>‚úÖ Visualizar em tempo real</li>
            </ul>
        </div>
    </div>

    <script>
        // Dados do localStorage
        let categories = JSON.parse(localStorage.getItem('icePanelCategories') || '[]');
        let titles = JSON.parse(localStorage.getItem('icePanelTitles') || '[]');
        let images = JSON.parse(localStorage.getItem('icePanelImages') || '[]');
        let gridLayout = JSON.parse(localStorage.getItem('icePanelGridLayout') || '{}');

        // Carregar dados ao inicializar
        document.addEventListener('DOMContentLoaded', function() {
            loadAvailableItems();
            updateGrid();
        });

        // Carregar itens dispon√≠veis
        function loadAvailableItems() {
            const container = document.getElementById('availableItems');
            container.innerHTML = '';

            // Agrupar imagens por categoria
            const groupedImages = {};
            images.forEach(image => {
                const category = categories.find(cat => cat.id === image.categoryId);
                const categoryName = category ? category.name : 'Sem categoria';
                
                if (!groupedImages[categoryName]) {
                    groupedImages[categoryName] = [];
                }
                groupedImages[categoryName].push(image);
            });

            // Renderizar por categoria
            Object.keys(groupedImages).forEach(categoryName => {
                const categoryDiv = document.createElement('div');
                categoryDiv.innerHTML = `<h4>üìÅ ${categoryName}</h4>`;
                
                const itemsDiv = document.createElement('div');
                itemsDiv.style.display = 'flex';
                itemsDiv.style.flexWrap = 'wrap';
                itemsDiv.style.gap = '10px';
                itemsDiv.style.marginBottom = '20px';

                groupedImages[categoryName].forEach(image => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'available-item';
                    itemDiv.draggable = true;
                    itemDiv.dataset.imageId = image.id;
                    itemDiv.innerHTML = `
                        <img src="${image.url}" alt="${image.name}" onerror="this.style.display='none'">
                        <div>${image.name}</div>
                    `;
                    
                    itemDiv.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', image.id);
                        e.dataTransfer.effectAllowed = 'move';
                    });
                    
                    itemsDiv.appendChild(itemDiv);
                });
                
                categoryDiv.appendChild(itemsDiv);
                container.appendChild(categoryDiv);
            });
        }

        // Atualizar grid
        function updateGrid() {
            const columns = parseInt(document.getElementById('gridColumns').value);
            const rows = parseInt(document.getElementById('gridRows').value);
            
            const grid = document.getElementById('displayGrid');
            grid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            grid.innerHTML = '';

            // Criar c√©lulas do grid
            for (let i = 0; i < columns * rows; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-item';
                cell.dataset.cellIndex = i;
                
                // Carregar item existente se houver
                const cellData = gridLayout[i];
                if (cellData) {
                    const image = images.find(img => img.id === cellData.imageId);
                    if (image) {
                        cell.innerHTML = `
                            <img src="${image.url}" alt="${image.name}" onerror="this.style.display='none'">
                            <div>${image.name}</div>
                            <button class="remove-btn" onclick="removeFromGrid(${i})">√ó</button>
                        `;
                    }
                } else {
                    cell.innerHTML = '<div>Vazio</div>';
                }

                // Eventos de drag and drop
                cell.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });

                cell.addEventListener('dragleave', function(e) {
                    this.classList.remove('dragover');
                });

                cell.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    const imageId = e.dataTransfer.getData('text/plain');
                    const cellIndex = parseInt(this.dataset.cellIndex);
                    
                    addToGrid(cellIndex, imageId);
                });

                grid.appendChild(cell);
            }
        }

        // Adicionar item ao grid
        function addToGrid(cellIndex, imageId) {
            const image = images.find(img => img.id === imageId);
            if (!image) return;

            gridLayout[cellIndex] = { imageId: imageId };
            localStorage.setItem('icePanelGridLayout', JSON.stringify(gridLayout));
            updateGrid();
        }

        // Remover item do grid
        function removeFromGrid(cellIndex) {
            delete gridLayout[cellIndex];
            localStorage.setItem('icePanelGridLayout', JSON.stringify(gridLayout));
            updateGrid();
        }

        // Limpar grid
        function clearGrid() {
            if (confirm('Tem certeza que deseja limpar todo o grid?')) {
                gridLayout = {};
                localStorage.setItem('icePanelGridLayout', JSON.stringify(gridLayout));
                updateGrid();
                alert('Grid limpo com sucesso!');
            }
        }
    </script>
</body>
</html>
